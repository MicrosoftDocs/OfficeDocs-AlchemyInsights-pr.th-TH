---
title: ปัญหาเกี่ยวกับการรับรองความถูกต้อง
ms.author: v-smandalika
author: v-smandalika
manager: dansimp
ms.date: 01/25/2021
ms.audience: Admin
ms.topic: article
ms.service: o365-administration
ROBOTS: NOINDEX, NOFOLLOW
localization_priority: Priority
ms.collection: Adm_O365
ms.custom:
- "7748"
- "9004339"
ms.openlocfilehash: 53bd0d8f8edaead519d0282239d3a6d338b297b9
ms.sourcegitcommit: 029c4697b77ce996d41ca74c4fa86de1bb84bd99
ms.translationtype: MT
ms.contentlocale: th-TH
ms.lasthandoff: 01/25/2021
ms.locfileid: "49974789"
---
# <a name="authentication-issues"></a>ปัญหาเกี่ยวกับการรับรองความถูกต้อง

**กำลังมองหาข้อมูลเกี่ยวกับรหัสข้อผิดพลาด AADSTS ที่ส่งกลับจาก Azure Active Directory (Azure AD) token service (STS) ใช่หรือไม่** ให้ดูที่การ [ตรวจสอบความถูกต้องของ AZURE AD และรหัสข้อผิดพลาดในการตรวจสอบ](https://docs.microsoft.com/azure/active-directory/develop/reference-aadsts-error-codes) เพื่อค้นหาคำอธิบายข้อผิดพลาด AADSTS การแก้ไขและการแก้ไขปัญหาที่แนะนำ

ข้อผิดพลาดการตรวจสอบอาจเป็นผลมาจากปัญหาต่างๆที่แตกต่างกันมากที่สุดที่สร้างข้อผิดพลาด๔๐๑หรือ๔๐๓ ตัวอย่างเช่นปัญหาต่อไปนี้สามารถนำไปสู่การตรวจสอบข้อผิดพลาดทั้งหมด:

- [ขั้นตอนการซื้อโทเค็นการเข้าถึง](https://docs.microsoft.com/azure/active-directory/develop/authentication-vs-authorization)ที่ไม่ถูกต้อง 
- [ขอบเขตสิทธิ์](https://docs.microsoft.com/azure/active-directory/develop/v2-permissions-and-consent)ที่ได้รับการกำหนดค่าไม่ดี 
- การขาดความ [ยินยอม](https://docs.microsoft.com/azure/active-directory/develop/howto-convert-app-to-be-multi-tenant#understanding-user-and-admin-consent)

เมื่อต้องการแก้ไขข้อผิดพลาดทั่วไปในการตรวจสอบให้ลองทำตามขั้นตอนที่ระบุไว้ด้านล่างที่ตรงกับข้อผิดพลาดที่คุณได้รับอย่างใกล้ชิดที่สุด อาจมีขั้นตอนมากกว่าหนึ่งขั้นตอนสำหรับข้อผิดพลาดที่คุณได้รับ

- **ข้อผิดพลาด๔๐๑ที่ไม่ได้รับอนุญาต: โทเค็นของคุณถูกต้องหรือไม่**

ตรวจสอบให้แน่ใจว่าแอปของคุณกำลังนำเสนอโทเค็นการเข้าถึงที่ถูกต้องไปยัง Microsoft Graph เป็นส่วนหนึ่งของการร้องขอ ข้อผิดพลาดนี้มักจะหมายความว่าโทเค็นการเข้าถึงอาจหายไปในส่วนหัวของการร้องขอการรับรองความถูกต้องของ HTTP หรือโทเค็นไม่ถูกต้องหรือหมดอายุแล้ว เราขอแนะนำให้คุณใช้ไลบรารีการรับรองความถูกต้องของ Microsoft (MSAL) สำหรับการซื้อโทเค็นการเข้าถึง นอกจากนี้ข้อผิดพลาดนี้อาจเกิดขึ้นถ้าคุณพยายามใช้โทเค็นการเข้าถึงที่ได้รับมอบสิทธิ์ให้กับบัญชี Microsoft ส่วนบุคคลเพื่อเข้าถึง API ที่สนับสนุนบัญชีผู้ใช้ที่ทำงานหรือโรงเรียน (บัญชีผู้ใช้ขององค์กรเท่านั้น)

**ข้อผิดพลาด๔๐๓ต้องห้าม: คุณได้เลือกชุดสิทธิ์ที่ถูกต้องหรือไม่**

ตรวจสอบให้แน่ใจว่าคุณได้ร้องขอชุดของสิทธิ์ที่ถูกต้องโดยยึดตาม Microsoft Graph APIs การโทรด้วยแอปของคุณ แนะนำสิทธิ์การใช้งานที่มีสิทธิ์น้อยที่สุดจะมีให้ในหัวข้อวิธีการอ้างอิงของ Microsoft Graph API ทั้งหมด นอกจากนี้สิทธิ์เหล่านั้นต้องได้รับอนุญาตให้แอปพลิเคชันโดยผู้ใช้หรือผู้ดูแลระบบ การให้สิทธิ์ตามปกติจะเกิดขึ้นผ่านหน้าความยินยอมหรือการใช้ใบรับรองการลงทะเบียนแอปพลิเคชัน Azure Portal จากใบมีด **การตั้งค่า** สำหรับแอปพลิเคชันให้คลิกสิทธิ์ **ที่****จำเป็น** จากนั้นคลิกสิทธิ์ในการให้สิทธิ์ สำหรับข้อมูลเพิ่มเติม ให้ดูที่

- [สิทธิ์ของ Microsoft Graph](https://docs.microsoft.com/graph/permissions-reference) 
- [การทำความเข้าใจเกี่ยวกับสิทธิ์และความยินยอมของ Azure AD](https://docs.microsoft.com/azure/active-directory/develop/v2-permissions-and-consent)

**ข้อผิดพลาด๔๐๓ Forbidden: แอปของคุณได้รับโทเค็นเพื่อให้ตรงกับสิทธิ์ที่เลือกหรือไม่**

ตรวจสอบให้แน่ใจว่าชนิดของสิทธิ์ที่ร้องขอหรือให้ตรงกับชนิดของโทเค็นการเข้าถึงที่แอปของคุณได้รับ คุณอาจร้องขอและให้สิทธิ์แอปแต่ใช้โทเค็นการไหลโค้ดแบบโต้ตอบแทนที่จะเป็นโทเค็นการไหลของข้อมูลประจำตัวของไคลเอ็นต์หรือร้องขอและให้สิทธิ์ที่ได้รับมอบสิทธิ์แต่ใช้โทเค็นการไหลของข้อมูลประจำตัวของไคลเอ็นต์แทนที่

สำหรับข้อมูลเพิ่มเติมที่เกี่ยวข้องกับการรับโทเค็นให้ดูที่:

- [รับสิทธิ์การเข้าถึงในนามของผู้ใช้และสิทธิ์ที่ได้รับมอบสิทธิ์](https://docs.microsoft.com/graph/auth-v2-user) 
- [Azure AD v 2.0-OAuth ๒.๐การไหลของรหัสการอนุญาต](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-auth-code-flow) 
- [รับสิทธิ์การเข้าถึงโดยไม่มีผู้ใช้ (บริการดีมอน) และสิทธิ์ของแอปพลิเคชัน](https://docs.microsoft.com/graph/auth-v2-service) 
- [การไหลของข้อมูลประจำตัวของไคลเอ็นต์ของ Azure AD v 2.0-OAuth ๒.๐](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-client-creds-grant-flow)

**ข้อผิดพลาด๔๐๓ต้องห้าม: การตั้งค่ารหัสผ่านใหม่**

ในขณะนี้ยังไม่มีสิทธิ์การใช้งานของดีมอนริการสิทธิ์บริการที่อนุญาตให้รีเซ็ตรหัสผ่านของผู้ใช้ APIs เหล่านี้จะได้รับการสนับสนุนโดยใช้การทำงานของโค้ดที่ได้รับมอบหมายแบบโต้ตอบกับผู้ดูแลระบบที่ลงชื่อเข้าใช้เท่านั้น สำหรับข้อมูลเพิ่มเติมให้ดูที่[สิทธิ์ของ Microsoft Graph](https://docs.microsoft.com/graph/permissions-reference)

**๔๐๓ Forbidden: ผู้ใช้มีสิทธิ์เข้าถึงและได้รับสิทธิ์การใช้งานหรือไม่**

สำหรับการกำหนดรหัสที่ได้รับมอบหมาย Microsoft Graph จะประเมินว่าการร้องขอได้รับอนุญาตจากสิทธิ์ที่ได้รับอนุญาตให้กับแอปและสิทธิ์ที่ผู้ใช้ที่ลงชื่อเข้าใช้มีอยู่หรือไม่ โดยทั่วไปแล้วข้อผิดพลาดนี้จะระบุว่าผู้ใช้ไม่ได้มีสิทธิ์เพียงพอที่จะดำเนินการคำขอ **หรือ** ผู้ใช้ไม่ได้รับสิทธิ์การใช้งานสำหรับข้อมูลที่กำลังเข้าถึง เฉพาะผู้ใช้ที่มีสิทธิ์หรือสิทธิ์การใช้งานที่จำเป็นสามารถทำให้การร้องขอเสร็จเรียบร้อยแล้ว

**ห้าม๔๐๓: คุณเลือก API ของทรัพยากรที่ถูกต้องหรือไม่**

บริการ API เช่น Microsoft Graph จะตรวจสอบว่าการอ้างสิทธิ์ *aud* (ผู้ชม) ในโทเค็นการเข้าถึงที่ได้รับตรงกับค่าที่คาดไว้สำหรับตัวเองและถ้าไม่มีข้อผิดพลาดของ๔๐๓ต้องห้ามเกิดขึ้น ข้อผิดพลาดทั่วไปที่เกิดขึ้นในข้อผิดพลาดนี้กำลังพยายามใช้โทเค็นที่ได้รับมาสำหรับ Azure AD Graph APIs, Outlook APIs หรือ Api ของ SharePoint/OneDrive เพื่อเรียกใช้ Microsoft Graph (หรือในทางกลับกัน) ตรวจสอบให้แน่ใจว่าแอป (หรือขอบเขต) แอปของคุณได้รับโทเค็นสำหรับการจับคู่ API ที่มีการโทรหาแอป

**๔๐๐ไม่มีการร้องขอหรือ๔๐๓ห้ามผู้ใช้ให้สอดคล้องกับนโยบายการเข้าถึงแบบมีเงื่อนไขขององค์กร (CA) ของพวกเขาหรือไม่**

โดยยึดตามนโยบายการเข้าถึงแบบมีเงื่อนไขขององค์กร (CA) ผู้ใช้ที่เข้าถึงทรัพยากร Microsoft Graph ผ่านแอปของคุณอาจถูกท้าทายสำหรับข้อมูลเพิ่มเติมที่ไม่มีอยู่ในโทเค็นการเข้าถึงแอปของคุณที่ได้รับจากเดิม ในกรณีนี้แอปของคุณจะได้รับ **๔๐๐ที่มี** ข้อผิดพลาด interaction_required ระหว่างการซื้อโทเค็นการเข้าถึงหรือ๔๐๓ที่มีข้อผิดพลาด ***insufficient_claims*** เมื่อโทรหา Microsoft Graph ในทั้งสองกรณีการตอบสนองข้อผิดพลาดมีข้อมูลเพิ่มเติมที่สามารถนำเสนอให้กับจุดสิ้นสุดที่ได้รับอนุญาตเพื่อท้าทายผู้ใช้สำหรับข้อมูลเพิ่มเติม (เช่นการรับรองความถูกต้องแบบหลายปัจจัยหรือการลงทะเบียนอุปกรณ์)

สำหรับข้อมูลเพิ่มเติมเกี่ยวกับการเข้าถึงแบบมีเงื่อนไขให้ดูที่:

- [การจัดการความท้าทายในการเข้าถึงตามเงื่อนไขโดยใช้ MSAL](https://docs.microsoft.com/azure/active-directory/develop/msal-error-handling-dotnet#conditional-access-and-claims-challenges) 
- [คำแนะนำสำหรับนักพัฒนาสำหรับการเข้าถึงแบบมีเงื่อนไขของ Azure Active Directory](https://docs.microsoft.com/azure/active-directory/develop/v2-conditional-access-dev-guide)

**_จุดสิ้นสุดของการสนับสนุนสำหรับ Azure Active Directory ไลบรารีการรับรองความถูกต้อง (ADAL) และ AZURE AD graph (graph)_* _

- เริ่มต้นวันที่30มิถุนายน๒๐๒๐เราจะไม่เพิ่มฟีเจอร์ใหม่อีกต่อไปในไลบรารีการรับรองความถูกต้องของ Azure Active Directory (ADAL) และ Azure AD Graph (Graph Graph) เราจะยังคงให้การสนับสนุนทางเทคนิคและการอัปเดตความปลอดภัยแต่จะไม่มีการอัปเดตของฟีเจอร์อีกต่อไป
- เริ่มต้นวันที่30มิถุนายน๒๐๒๒เราจะสิ้นสุดการสนับสนุนสำหรับ ADAL และ AAD กราฟและจะไม่ให้การสนับสนุนทางเทคนิคหรือการอัปเดตความปลอดภัยอีกต่อไป
    - แอปที่ใช้ ADAL บน OS เวอร์ชันที่มีอยู่จะยังคงทำงานต่อไปหลังจากเวลานี้แต่จะไม่ได้รับการสนับสนุนทางเทคนิคหรือการอัปเดตความปลอดภัย
    - แอปที่ใช้กราฟ AAD หลังจากเวลานี้อาจไม่ได้รับการตอบสนองจากจุดสิ้นสุดของกราฟ AAD

การ *โยกย้าย _ ADAL**

เราขอแนะนำให้อัปเดตเป็น [ไลบรารีการรับรองความถูกต้องของ Microsoft (MSAL)](https://docs.microsoft.com/azure/active-directory/develop/v2-overview)ซึ่งมีฟีเจอร์และการอัปเดตความปลอดภัยล่าสุด คำแนะนำนี้อยู่ในบริบทของ Microsoft ในการโยกย้ายแอปพลิเคชันของแอปพลิเคชันไปยัง MSAL โดยสิ้นสุดการสนับสนุนสิ้นสุด วัตถุประสงค์ของการโยกย้ายของ Microsoft apps to MSAL คือเพื่อให้แน่ใจว่าแอปที่ได้รับประโยชน์จากการปรับปรุงการรักษาความปลอดภัยและฟีเจอร์ที่ต่อเนื่องของ MSAL

- [อ่านคำถามที่ถามบ่อยเกี่ยวกับ ADAL](https://docs.microsoft.com/azure/active-directory/develop/msal-migration#frequently-asked-questions-faq) 
- [เรียนรู้เกี่ยวกับวิธีการโยกย้ายแอปบนไซต์ต่อเนื่อง](https://docs.microsoft.com/azure/active-directory/develop/msal-migration#frequently-asked-questions-faq) 
- ถ้าคุณต้องการความช่วยเหลือในการทำความเข้าใจเกี่ยวกับแอปที่คุณใช้ ADAL เราขอแนะนำให้คุณตรวจทานโค้ดต้นฉบับของแอพทั้งหมดของคุณและถ้ามีให้ติดต่อผู้จำหน่ายซอฟต์แวร์อิสระ (Isv) หรือผู้ให้บริการแอป ฝ่ายสนับสนุนของ microsoft ยังสามารถให้คุณมีรายการของแอป ADAL ที่ไม่ใช่ Microsoft ทั้งหมดในผู้เช่าของคุณ

**การโยกย้ายกราฟ AAD**

สำหรับแอปพลิเคชันที่ใช้กราฟ AAD ให้ทำตามคำแนะนำของเราในการ[โยกย้ายแอปกราฟโฆษณา Azure ไปยัง Microsoft Graph](https://docs.microsoft.com/graph/migrate-azure-ad-graph-planning-checklist?view=graph-rest-1.0&preserve-view=true)

- [รายการตรวจสอบการโยกย้ายของเรามีจุดเริ่มต้นใช้](https://docs.microsoft.com/graph/migrate-azure-ad-graph-planning-checklist)งาน 
- พอร์ทัลการลงทะเบียนแอ Azure ของคุณแสดงแอปพลิเคชันที่ใช้กราฟ AAD เราขอแนะนำให้คุณตรวจทานโค้ดต้นฉบับของแอปของคุณทั้งหมดและถ้ามีผลบังคับให้ติดต่อกับ Isv หรือผู้ให้บริการแอป ฝ่ายสนับสนุนของ Microsoft ยังสามารถให้ข้อมูลเกี่ยวกับการใช้งานทั้งหมดของการใช้กราฟ AAD ในผู้เช่าของคุณได้

 










